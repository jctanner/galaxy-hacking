docker cp ah-dump.xz galaxy_ng_postgres_1:/tmp/.                                                                                                                                                                                              

docker exec -it galaxy_ng_postgres_1 /bin/bash
cd /tmp
xz -d ah-dump.gz

apt update
apt install procps


# need to kill all active psql clients first? ...
docker ps -a | fgrep -v postgres | awk '{print $1}' | fgrep -v CONTAINER | xargs -I {} docker kill {}


# Make the script that drop all the current tables ...
psql -d galaxy_ng -U galaxy_ng

bash -c 'psql -U galaxy_ng -d galaxy_ng -c "select '"'"'psql -U galaxy_ng -d galaxy_ng -c \"drop table if exists \\\"'"'"' || tablename || '"'"'\\\" cascade;\"'"'"' from pg_tables;" | grep drop >> /tmp/drop.sh'


# copy the dump to the psql container and load it

docker cp ah-dump.xz galaxy_ng_postgres_1:/tmp/.

docker exec -it galaxy_ng_postgres_1 /bin/bash
cd /tmp
xz -d ah-dump.gz
chmod +x drop.sh
./drop.sh
psql -U galaxy_ng -d galaxy_ng < /tmp/ah-dump

# re-apply migrations
make docker/migrate
make docker/loaddata # to get admin user

